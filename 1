INSERT INTO user_agent_access (user_id, environment, granted_by)
VALUES (USER_ID, '*', 'manual_fix');
sqlite3 orchestration.db

-- List recent sessions
SELECT session_token, user_id, expires_at, created_at 
FROM user_sessions 
ORDER BY created_at DESC LIMIT 5;



SELECT session_token, expires_at, datetime('now') as now_time
FROM user_sessions 
ORDER BY created_at DESC LIMIT 3;

-- Does that user_id actually exist and is active?
SELECT s.session_token, s.user_id, u.username, u.role, u.is_active
FROM user_sessions s
LEFT JOIN users u ON s.user_id = u.user_id
ORDER BY s.created_at DESC LIMIT 5;













-- Verify
SELECT u.username, u.role, uaa.environment 
FROM users u 
JOIN user_agent_access uaa ON u.user_id = uaa.user_id;




SELECT user_id, username, role, created_at 
FROM users 
WHERE LOWER(username) LIKE LOWER('%mudiganti%')
ORDER BY created_at;

-- 2. Pick the ONE user_id you want to keep (probably the oldest/first one)
--    Then update it to have admin role:
UPDATE users SET role = 'admin' WHERE user_id = <YOUR_USER_ID>;

-- 3. Delete the duplicate records (keep the one you updated)
DELETE FROM users 
WHERE LOWER(username) LIKE LOWER('%mudiganti%') 
AND user_id != <YOUR_USER_ID>;

-- 4. Also ensure you have admin in user_roles table
INSERT OR IGNORE INTO user_roles (user_id, role_id, assigned_by)
SELECT <YOUR_USER_ID>, role_id, 'manual_fix'
FROM roles WHERE role_name = 'admin';

-- 5. Clear any stale sessions (optional, forces re-login)
DELETE FROM user_sessions WHERE user_id != <YOUR_USER_ID>;

SELECT u.username, r.role_name, ur.assigned_at 
FROM users u 
LEFT JOIN user_roles ur ON u.user_id = ur.user_id 
LEFT JOIN roles r ON ur.role_id = r.role_id 
WHERE u.username LIKE '%Mudiganti%' OR u.username LIKE '%Raj%';

UPDATE users SET role = 'admin' WHERE username = 'YOUR_USERNAME';

-- Option B: Add admin role to user_roles table
INSERT INTO user_roles (user_id, role_id, assigned_by)
SELECT u.user_id, r.role_id, 'manual_fix'
FROM users u, roles r
WHERE u.username = 'YOUR_USERNAME' AND r.role_name = 'admin';
